import{_ as i}from"./chunks/plugin-vue_export-helper.DlAUqK2U.js";import{c as a,o as n,X as h}from"./chunks/vendor-vueuse.XPft87tp.js";const y=JSON.parse('{"title":"如何取消 Fetch 请求","description":"","frontmatter":{},"headers":[],"relativePath":"fragment/fetch.md","filePath":"fragment/fetch.md","lastUpdated":1771466668000}'),l={name:"fragment/fetch.md"};function t(k,s,p,e,F,r){return n(),a("div",null,s[0]||(s[0]=[h(`<h1 id="如何取消-fetch-请求" tabindex="-1">如何取消 Fetch 请求 <a class="header-anchor" href="#如何取消-fetch-请求" aria-label="Permalink to &quot;如何取消 Fetch 请求&quot;">​</a></h1><p>JavaScript 的 promise 一直是该语言的一大胜利——它们引发了异步编程的革命，极大地改善了 Web 性能。原生 promise 的一个缺点是，到目前为止，还没有可以取消 fetch 的真正方法。 JavaScript 规范中添加了新的 AbortController ，允许开发人员使用信号中止一个或多个 fetch 调用。 以下是取消 fetch 调用的工作流程：</p><ul><li>创建一个 AbortController 实例</li><li>该实例具有 signal 属性</li><li>将 signal 传递给 fetch option 的 signal</li><li>调用 AbortController 的 abort 属性来取消所有使用该信号的 fetch。</li></ul><p>以下是取消 Fetch 请求的基本步骤：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes dracula vitesse-black vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#FF79C6;--shiki-light-font-weight:bold;--shiki-dark:#CB7676;--shiki-dark-font-weight:inherit;"> new</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;"> AbortController</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">();</span></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> }</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">fetch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">http://localhost:8000</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">then</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">response</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Request 1 is complete!</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">catch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">warn</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Fetch 1 error: </span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">\${</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">message</span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">}</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6272A4;--shiki-dark:#758575DD;">// Abort request</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">abort</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在 abort 调用时发生 AbortError ，因此你可以通过比较错误名称来侦听 catch 中的中止操作。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes dracula vitesse-black vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">catch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">e</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">name</span><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;"> ===</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">AbortError</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#6272A4;--shiki-dark:#758575DD;">        // We know it&#39;s been canceled!</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">    }</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将相同的信号传递给多个 fetch 调用将会取消该信号的所有请求：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes dracula vitesse-black vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#FF79C6;--shiki-light-font-weight:bold;--shiki-dark:#CB7676;--shiki-dark-font-weight:inherit;"> new</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;"> AbortController</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">();</span></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> }</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">fetch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">http://localhost:8000</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">then</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">response</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Request 1 is complete!</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">catch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">warn</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Fetch 1 error: </span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">\${</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">message</span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">}</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">fetch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">http://localhost:8000</span><span style="--shiki-light:#E9F284;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">then</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">response</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">log</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Request 2 is complete!</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  })</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  .</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">catch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">((</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">    console</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">warn</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D;">Fetch 2 error: </span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">\${</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">e</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#C98A7D;">message</span><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">}</span><span style="--shiki-light:#F1FA8C;--shiki-dark:#C98A7D77;">\`</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6272A4;--shiki-dark:#758575DD;">// Wait 2 seconds to abort both requests</span></span>
<span class="line"><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">setTimeout</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(()</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">abort</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(),</span><span style="--shiki-light:#BD93F9;--shiki-dark:#4C9A91;"> 2000</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>杰克·阿奇博尔德（Jack Archibald）在他的文章 <a href="https://developer.chrome.com/blog/abortable-fetch?hl=zh-cn" target="_blank" rel="noreferrer">Abortable fetch</a> 中，详细介绍了一个很好的应用，它能够用于创建可中止的 Fetch，而无需所有样板</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes dracula vitesse-black vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">function</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;"> abortableFetch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;">request</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#FFB86C;--shiki-light-font-style:italic;--shiki-dark:#BD976A;--shiki-dark-font-style:inherit;"> opts</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">)</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">  const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#FF79C6;--shiki-light-font-weight:bold;--shiki-dark:#CB7676;--shiki-dark-font-weight:inherit;"> new</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;"> AbortController</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">();</span></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#CB7676;">  const</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#FF79C6;--shiki-dark:#4D9375;">  return</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span></span>
<span class="line"><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">    abort</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;">:</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> ()</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> =&gt;</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> controller</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">.</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;">abort</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(),</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#B8A965;">    ready</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;">:</span><span style="--shiki-light:#50FA7B;--shiki-dark:#80A665;"> fetch</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">(</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">request</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> {</span><span style="--shiki-light:#FF79C6;--shiki-dark:#444444;"> ...</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;">opts</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">,</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#BD976A;"> signal</span><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;"> }),</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">  };</span></span>
<span class="line"><span style="--shiki-light:#F8F8F2;--shiki-dark:#444444;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>说实话，我对取消 Fetch 的方法并不感到兴奋。在理想的世界中，通过 Fetch 返回的 Promise 中的 .cancel() 会很酷，但是也会带来一些问题。无论如何，我为能够取消 Fetch 调用而感到高兴，你也应该如此！</p><h2 id="译-如何取消你的-promise" tabindex="-1"><a href="https://juejin.cn/post/6844903533393772557" target="_blank" rel="noreferrer">[译] 如何取消你的 Promise？</a> <a class="header-anchor" href="#译-如何取消你的-promise" aria-label="Permalink to &quot;[[译] 如何取消你的 Promise？](https://juejin.cn/post/6844903533393772557)&quot;">​</a></h2>`,13)]))}const c=i(l,[["render",t]]);export{y as __pageData,c as default};
